// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  STAFF
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum NeedStatus {
  NEW
  IN_REVIEW
  IN_PROGRESS
  DONE
  ARCHIVED
}

enum FileType {
  IMAGE
  DOCUMENT
  AUDIO
  VIDEO
  OTHER
}

enum ComplexityLevel {
  LOW
  MEDIUM
  HIGH
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  passwordHash      String
  role              UserRole @default(ADMIN)
  mustChangePassword Boolean  @default(true)
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?

  @@map("users")
}

model Need {
  id                 String      @id @default(cuid())
  clientName         String
  clientEmail        String?
  clientPhone        String?
  companyName        String?
  problemDescription String
  currentSituation   String
  desiredSolution    String
  knownAppReferences String?
  budgetMin          Float?
  budgetMax          Float?
  deadlinePreference String?
  priority           Priority    @default(MEDIUM)
  language           String?
  status             NeedStatus  @default(NEW)
  internalNotes      String?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
  deletedAt          DateTime?

  files    NeedFile[]
  analyses NeedAnalysis[]

  @@map("needs")
}

model NeedFile {
  id           String   @id @default(cuid())
  needId       String
  type         FileType
  url          String
  mimeType     String
  originalName String
  size         Int?
  createdAt    DateTime @default(now())

  need Need @relation(fields: [needId], references: [id], onDelete: Cascade)

  @@map("need_files")
}

model NeedAnalysis {
  id                  String          @id @default(cuid())
  needId              String
  summary             String
  objectives          String
  proposedSolution    String
  complexityLevel     ComplexityLevel
  estimatedDuration   String?
  estimatedBudgetRange String?
  risks               String?
  createdAt           DateTime        @default(now())

  need Need @relation(fields: [needId], references: [id], onDelete: Cascade)

  @@map("need_analyses")
}

model AppSettings {
  id              Int      @id @default(autoincrement())
  maintenanceMode Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("app_settings")
}

